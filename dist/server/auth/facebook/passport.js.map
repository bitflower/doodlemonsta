{"version":3,"sources":["auth/facebook/passport.js"],"names":[],"mappings":";;;;;;;;;wBAAqB,UAAU;;;;gCACc,mBAAmB;;AAEzD,SAAS,KAAK,CAAC,IAAI,EAAE,MAAM,EAAE;AAChC,0BAAS,GAAG,CAAC,+BAAqB;AAC1B,gBAAQ,EAAE,MAAM,CAAC,QAAQ,CAAC,QAAQ;AAClC,oBAAY,EAAE,MAAM,CAAC,QAAQ,CAAC,YAAY;AAC1C,mBAAW,EAAE,MAAM,CAAC,QAAQ,CAAC,WAAW;;AAExC,qBAAa,EAAE,CACX,aAAa,EACb,QAAQ,CACX;KACJ,EACD,UAAS,WAAW,EAAE,YAAY,EAAE,OAAO,EAAE,IAAI,EAAE;AAC/C,YAAI,CAAC,YAAY,CAAC;AACV,yBAAa,EAAE,OAAO,CAAC,EAAE;SAC5B,CAAC,CACD,IAAI,CAAC,UAAA,IAAI,EAAI;AACV,gBAAI,IAAI,EAAE;;;AAGN,oBAAI,CAAC,SAAS,GAAG,IAAI,IAAI,EAAE,CAAC;AAC5B,oBAAI,CAAC,IAAI,CAAC,UAAS,GAAG,EAAE,KAAK,EAAE;AAC3B,wBAAI,GAAG,EAAE,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC;AAC1B,2BAAO,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;iBAC5B,CAAC,CAAC;aAEN,MAAM;;AAEH,oBAAI,GAAG,IAAI,IAAI,CAAC;AACZ,wBAAI,EAAE,OAAO,CAAC,WAAW;AACzB,yBAAK,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK;AAC9B,wBAAI,EAAE,MAAM;AACZ,4BAAQ,EAAE,UAAU;AACpB,4BAAQ,EAAE,OAAO,CAAC,KAAK;iBAC1B,CAAC,CAAC;;AAEH,oBAAI,CAAC,SAAS,EAAE,CACX,IAAI,CAAC,UAAA,IAAI;2BAAI,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC;iBAAA,CAAC,SACzB,CAAC,UAAA,GAAG;2BAAI,IAAI,CAAC,GAAG,CAAC;iBAAA,CAAC,CAAC;aAChC;SAEJ,CAAC,SACI,CAAC,UAAA,GAAG;mBAAI,IAAI,CAAC,GAAG,CAAC;SAAA,CAAC,CAAC;KAChC,CAAC,CAAC,CAAC;CACX","file":"auth/facebook/passport.js","sourcesContent":["import passport from 'passport';\nimport { Strategy as FacebookStrategy } from 'passport-facebook';\n\nexport function setup(User, config) {\n    passport.use(new FacebookStrategy({\n            clientID: config.facebook.clientID,\n            clientSecret: config.facebook.clientSecret,\n            callbackURL: config.facebook.callbackURL,\n            // enableProof: true,\n            profileFields: [\n                'displayName',\n                'emails'\n            ]\n        },\n        function(accessToken, refreshToken, profile, done) {\n            User.findOneAsync({\n                    'facebook.id': profile.id\n                })\n                .then(user => {\n                    if (user) {\n\n                        // Set last login date\n                        user.lastLogin = new Date();\n                        user.save(function(err, _user) {\n                            if (err) return done(err);\n                            return done(null, _user);\n                        });\n\n                    } else {\n\n                        user = new User({\n                            name: profile.displayName,\n                            email: profile.emails[0].value,\n                            role: 'user',\n                            provider: 'facebook',\n                            facebook: profile._json\n                        });\n\n                        user.saveAsync()\n                            .then(user => done(null, user))\n                            .catch(err => done(err));\n                    }\n\n                })\n                .catch(err => done(err));\n        }));\n}\n"],"sourceRoot":"/source/"}